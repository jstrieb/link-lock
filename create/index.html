<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
  <!-- Metadata -->
  <meta charset="utf-8" />
  <meta name="author" content="Jacob Strieb" />
  <meta name="description" content="Password protect links using AES in the browser." />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

  <link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">

  <title>Link Lock - Password-protect links</title>

  <!-- Styles -->
  <link rel="stylesheet" href="../style.css" type="text/css" />

  <!-- Scripts -->
  <script type="text/javascript" src="../b64.js"></script>
  <script type="text/javascript" src="../api.js"></script>
  <script type="text/javascript">
    function error(text) {
      document.querySelector(".error").style.display = "inherit";
      document.querySelector("#errortext").innerText = `Error: ${text}`;
    }


    // Run when the <body> loads
    function main() {
      // Fail if the b64 library or API was not loaded
      if (!("b64" in window)) {
        error("Base64 library not loaded.");
        return;
      }
      if (!("apiVersions" in window)) {
        error("API library not loaded.");
        return;
      }
    }
  </script>
  <script type="text/javascript" src="create.js"></script>
</head>

<body onload="main()">
  <!-- Explanation for those who do not have JavaScript enabled -->
  <noscript>
  <div style="border: 3px solid red; padding: 2em;">
    <p>If you are seeing this, it means that you have JavaScript disabled. As a result, the application will not work properly for you. For example, none of the buttons will work.</p>

    <p>This application is entirely programmed in JavaScript. This was done intentionally, so that all encryption and decryption happens client-side. This means the code runs as a distributed application, relying only on GitHub Pages for infrastructure. It also means that no data about locked links is ever stored on a server. The code is designed to be auditable so users can investigate what is happening behind the scenes.</p>

    <p>If you still want to run the application, I encourage you to clone the <a href="https://github.com/jstrieb/link-lock">source code on GitHub</a>. That way you can disable JavaScript only for trusted files on your local machine.</p>
  </div>
  </noscript>

  <!-- Display errors in a big red box -->
  <div class="error red-border" style="display: none">
    <p id="errortext">Error</p>
    <button onclick="main()">Try again</button>
  </div>

  <!-- Project description -->
  <h1>Link Lock</h1>
  <div>
    <p>Link Lock adds passwords to links. Enter a link and password below, and click "Encrypt" to generate a locked link. When someone visits a locked link, it will not unlock unless they enter the correct password. If the password is correct, they will be redirected to the original link.</p>
    <p>To bookmark a locked link, drag it from the output box to the bookmarks bar. Alternatively, visit the locked link and bookmark it before entering the password.</p>
    <p>This application uses encryption to make it nearly impossible to recover the original link from the locked one. This means that a lost password will make locked links unrecoverable. Randomizing the salt and initialization vector in the advanced options will make the encryption more secure at the cost of a longer link. Read more about the encryption used on the <a href="https://github.com/jstrieb/link-lock" target="_blank">Link Lock GitHub repository</a>.</p>
    <p>Link Lock runs entirely in the browser, so nobody can see the links you are locking and unlocking. No data is ever stored on any server. There is no tracking, no spying, and no cookies. If you do not trust it, read the source code, or run your own instance.</p>
  </div>

  <!-- Main form -->
  <div class="form">
    <div class="labeled-input">
      <label for="url">link</label>
      <input type="url" id="url" placeholder="" oninvalid="this.setCustomValidity('Please enter a valid URL. Make sure to include \'http://\' at the beginning.')" oninput="this.setCustomValidity('')" autofocus required />
    </div>
    <div class="labeled-input hint">
      <label for="url">hint (optional)</label>
      <input type="text" id="hint" />
    </div>
    <div class="split-row">
      <div class="labeled-input password">
        <label for="password">password</label>
        <input type="password" id="password" />
      </div>
      <div class="labeled-input confirm-password">
        <label for="confirm-password">confirm password</label>
        <input type="password" id="confirm-password" oninput="this.setCustomValidity('')" />
      </div>
    </div>

    <!-- Advanced options (JavaScript-activated dropdown) -->
    <label onclick="onAdvanced()" id="advanced-label" for="advanced">&#x25B8; advanced</label>
    <div class="advanced" id="advanced">
      <div class="labeled-input">
        <label for="iv">random initialization vector</label>
        <input type="checkbox" id="iv" checked />
      </div>
      <div class="labeled-input">
        <label for="salt">random salt</label>
        <input type="checkbox" id="salt" />
      </div>
    </div>
    <button id="encrypt" onclick="onEncrypt()">Encrypt</button>
  </div>

  <hr />

  <!-- Output area -->
  <div class="output">
    <label for="output">output</label>
    <input type="text" id="output" readonly/>
    <button id="copy" onclick="onCopy('output')">Copy</button>
    <a href="" id="open" target="_blank"><button>Open in New Tab</button></a>
    <p class="alert">Copied</p>
  </div>

  <!-- Page footer -->
  <footer>
  <hr />
  <p class="copyright">Created by <a href="https://jstrieb.github.io">Jacob Strieb</a>.</p>
  </footer>
</body>

</html>
